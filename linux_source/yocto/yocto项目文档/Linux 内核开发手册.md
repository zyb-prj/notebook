# 1 引言

## 1.1 概述

无论你打算如何使用 Yocto 项目，你都有可能使用 Linux 内核。本手册介绍了如何设置你的构建主机以支持内核开发，介绍了内核开发过程，提供了有关 Yocto Linux 内核 [Metadata](#Metadata) 的背景信息，描述了你可以使用内核工具执行的常见任务，向你展示了如何使用 Yocto 项目内的内核元数据，并深入介绍了 Yocto 项目团队如何开发和维护 Yocto Linux 内核 Git 仓库和元数据。

## 1.2 内核修改工作流程

# 2 通用任务

## 2.1 准备好联编主机以在内核上工作

### 2.1.1 准备使用 devtool 进行开发

### 2.1.2 为传统内核开发做好准备

## 2.2 创建和准备图层

## 2.3 修改现有配方

### 2.3.1 创建附加文件

### 2.3.2 应用补丁

### 2.3.3 更改配置

### 2.3.4 使用 "树内 "defconfig 文件

## 2.4 使用 devtool 修补内核

## 2.5 使用传统内核开发方法为内核打补丁

## 2.6 配置内核

### 2.6.1 使用 menuconfig

### 2.6.2 创建 defconfig 文件

### 2.6.3 创建配置片段

### 2.6.4 验证配置

### 2.6.5 微调内核配置文件

## 2.7 扩展变量

## 2.8 处理 "脏 "内核版本字符串

## 2.9 使用自己的源代码

## 2.10 使用树外模块

### 2.10.1 在目标上构建树外模块

### 2.10.2 整合树外模块

## 2.11 检查更改和提交

### 2.11.1 内核中有哪些改动？

### 2.11.2 显示特定特性或分支变更

## 2.12 添加配方空间内核特征

# 3 使用高级元数据（yocto-kernel-cache）

## 3.1 概述

## 3.2 在配方中使用内核元数据

## 3.3 内核元数据语法

### 3.3.1 配置

### 3.3.2 补丁

### 3.3.3 特征

### 3.3.4 内核类型

### 3.3.5 BSP 描述

#### 3.3.5.1 描述概述

#### 3.3.5.2 示例

## 3.4 内核元数据位置

### 3.4.1 配方空间元数据

### 3.4.2 配方空间之外的元数据

## 3.5 整理源代码

### 3.5.1 封装补丁

### 3.5.2 机器分支

### 3.5.3 特征分支

## 3.6 SCC 描述文件参考

# 4 高级内核概念

## 4.1 Yocto 项目内核开发与维护

## 4.2 Yocto Linux 内核架构和分支策略

## 4.3 内核构建文件层次结构

## 4.4 确定内核配置审核阶段的硬件和非硬件特性

# 5 内核维护

## 5.1 构建内核树

## 5.2 构建策略

# 6 内核开发常见问题

## 6.1 常见问题和解决方案

### 6.1.1 如何使用自己的 Linux 内核 .config 文件？

### 6.1.2 如何创建配置片段？

### 6.1.3 如何使用我自己的 Linux 内核源代码？

### 6.1.4 如何在根文件系统上安装/不安装内核映像？

### 6.1.5 如何安装特定的内核模块？

### 6.1.6 如何更改 Linux 内核命令行？

# 7 参考手册

## Metadata

Yocto 项目的一个关键要素是用于构建 Linux 发行版的元数据（Metadata），它包含在 OpenEmbedded 编译系统在构建映像时解析的文件中。一般来说，元数据包括配方、配置文件和其他与构建指令本身相关的信息，以及用于控制构建内容和构建效果的数据。元数据还包括用于说明所使用软件版本的命令和数据、这些命令和数据的来源，以及对软件本身的更改或添加（补丁或辅助文件），这些更改或添加用于修复错误或定制软件，以便在特定情况下使用。OpenEmbedded-Core 是一套重要的验证元数据。

在内核（"内核元数据"）方面，该术语指的是 yocto-kernel-cache Git 仓库中包含的内核配置片段和功能。